<div id="siteViewOuterBox" class="centerVH">
  @if (currentSite !== undefined) {
    <div class="main">
      <div class="siteInfoDiv">
        <div class="siteNameDiv column">
          <span>{{ currentSite.siteInfo.siteName }}</span>
          <span>{{ currentSite.siteInfo.siteUrl }}</span>
        </div>
        <div class="siteExtrasDiv column">
          <span>{{ currentSite.siteInfo.siteId }}</span>
          <span>{{ currentSite.trackedSince }}</span>
        </div>
        <div class="optionsDiv row">
          <button class="s_button" type="button" (click)="toggleEditMode()">
            <div class="s_button__int">
              <span>Edit site </span>
            </div>
          </button>
          <button class="s_button" type="button" (click)="attemptSiteRemoval()">
            <div class="s_button__int">
              <span>Remove site</span>
            </div>
          </button>
        </div>
        <div class="descDiv">
          {{ currentSite.description }}
        </div>
        <div>
          <span>Last update: {{ currentSite.siteInfo.lastUpdateAt }}
            . Registered updates: {{ currentSite.updates.length }}</span>
        </div>
      </div>
      <div class="siteUpdatesDiv column">
        <div id="siteUpdatesContainer">
          @for (update of currentSite.updates; track $index) {
            <app-bare-update-box [update]="update"></app-bare-update-box>
          }
        </div>
        <button class="s_button" style="flex: 0 0 10%" type="button" (click)="refetchCurrentSiteDetails()">
          <div class="s_button__int">
            <span>Refresh updates</span>
          </div>
        </button>
      </div>
    </div>
  } @else {
    <span class="error-box centerVH" style="font-size: 1.4em">
    @if (siteFetchErrorMessage !== undefined) {
      {{ siteFetchErrorMessage }}
    } @else {
      Couldn't load the site details. Please try again later.
    }
  </span>
  }
  @if (isInEditMode && siteEditForm !== undefined) {
    <form class="siteEditDiv" [formGroup]="siteEditForm" (ngSubmit)="attemptSiteEdit()">
      <div class="editTitleDiv column">
        <div class="box-input">
          <div class="border">
            <input formControlName="siteName" type="text" name="text" class="input">
          </div>
        </div>
        @if (siteEditForm.get('siteName')?.invalid && siteEditForm.get('siteName')?.touched){
          <span class="error-box">Site name is required.</span>
        }
      </div>
      <div class="editControlDiv">
        <div class="editTitleDiv column">
          <div class="box-input">
            <div class="border">
              <input formControlName="siteDesc" type="text" name="text" class="input">
            </div>
          </div>
        </div>
      </div>
      <div class="editButtonsDiv column">
        <span class="error-box">
          @if (siteEditErrorMessage !== undefined) {
            {{siteFetchErrorMessage}}
          }
        </span>
        <div class="row">
          <button class="s_button" type="submit">
            <div class="s_button__int">
              <span>Save changes</span>
            </div>
          </button>
          <button class="s_button" type="button" (click)="toggleEditMode()">
            <div class="s_button__int">
              <span>Cancel</span>
            </div>
          </button>
        </div>
      </div>
    </form>
  }
</div>
